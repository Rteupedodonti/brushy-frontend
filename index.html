<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diş Fırçalama Takip</title>
    <script type="text/javascript" nonce="b635fea0a2bf4e60b846def1363" src="//local.adguard.org?ts=1761285055505&amp;type=content-script&amp;dmn=mgx.dev&amp;url=https%3A%2F%2Fmgx.dev%2Fapi%2Fv1%2Ffiles%2Fdownload%3Fpath%3D%252Fchats%252Fcdb8c0f7114c47c9859d204a340a434d%252F.storage%252F81%252F28e07ea2%252Findex.html&amp;app=opera.exe&amp;css=3&amp;js=1&amp;rel=1&amp;rji=1&amp;sbe=1"></script><script type="text/javascript" nonce="b635fea0a2bf4e60b846def1363" src="//local.adguard.org?ts=1761285055505&amp;name=AdGuard%20Extra&amp;name=AdGuard%20Popup%20Blocker&amp;type=user-script"></script><link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#4CAF50">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Diş Takip">
    <link rel="apple-touch-icon" href="icon-192x192.png">
</head>
<body>
    <!-- Auth Screen (Kayıt/Giriş) -->
    <div id="auth-screen" class="screen active">
        <div class="auth-container">
            <div class="app-header">
                <div class="tooth-icon">🦷</div>
                <h1>Diş Fırçalama Takip</h1>
                <p>Çocuklar için eğlenceli diş bakımı</p>
            </div>
            
            <div class="auth-tabs">
                <button class="auth-tab active" data-tab="register">Kayıt Ol</button>
                <button class="auth-tab" data-tab="login">Giriş Yap</button>
            </div>

            <!-- Kayıt Formu -->
            <div id="register-form" class="auth-form active">
                <h2>Veli Kaydı</h2>
                <form id="parent-register-form">
                    <div class="form-group">
                        <label for="parent-name">Veli Adı Soyadı</label>
                        <input type="text" id="parent-name" required>
                    </div>
                    <div class="form-group">
                        <label for="parent-phone">Telefon Numarası</label>
                        <input type="tel" id="parent-phone" required>
                    </div>
                    <div class="form-group">
                        <label for="parent-email">E-posta (Opsiyonel)</label>
                        <input type="email" id="parent-email">
                    </div>
                    
                    <button type="submit" class="btn-primary">Kayıt Ol</button>
                </form>
            </div>

            <!-- Giriş Formu -->
            <div id="login-form" class="auth-form">
                <h2>Giriş Yap</h2>
                <form id="parent-login-form">
                    <div class="form-group">
                        <label for="login-phone">Telefon Numarası</label>
                        <input type="tel" id="login-phone" required>
                    </div>
                    <div class="form-group">
                        <label for="login-name">Veli Adı</label>
                        <input type="text" id="login-name" required>
                    </div>
                    <button type="submit" class="btn-primary">Giriş Yap</button>
                </form>
            </div>

            <!-- Admin Access Button -->
            <div class="admin-access">
                <button class="admin-btn" onclick="showAdminLogin()">⚙️ Admin</button>
            </div>
        </div>
    </div>

    <!-- Admin Login Modal -->
    <div id="admin-login-modal" class="modal" style="display: none;">
        <div class="modal-content admin-modal">
            <h3>Admin Girişi</h3>
            <div class="form-group">
                <label for="admin-password">Admin Şifresi</label>
                <input type="password" id="admin-password" placeholder="Şifrenizi girin">
            </div>
            <div class="form-actions">
                <button type="button" onclick="hideAdminLogin()">İptal</button>
                <button type="button" onclick="verifyAdminAccess()" class="btn-primary">Giriş</button>
            </div>
        </div>
    </div>

    <!-- Admin Panel Screen -->
    <div id="admin-panel-screen" class="screen">
        <div class="header">
            <button class="back-btn" onclick="showScreen('auth-screen')">←</button>
            <h1>Admin Paneli</h1>
            <button class="logout-btn" onclick="logoutAdmin()">Çıkış</button>
        </div>

        <div class="admin-content">
            <!-- System Status -->
            <div class="admin-section">
                <h3>🔧 Sistem Durumu</h3>
                <div class="status-grid">
                    <div class="status-card">
                        <div class="status-icon">👥</div>
                        <div class="status-info">
                            <div class="status-number" id="total-parents">0</div>
                            <div class="status-label">Toplam Veli</div>
                        </div>
                    </div>
                    <div class="status-card">
                        <div class="status-icon">👶</div>
                        <div class="status-info">
                            <div class="status-number" id="total-children">0</div>
                            <div class="status-label">Toplam Çocuk</div>
                        </div>
                    </div>
                    <div class="status-card">
                        <div class="status-icon">🦷</div>
                        <div class="status-info">
                            <div class="status-number" id="total-sessions">0</div>
                            <div class="status-label">Toplam Fırçalama</div>
                        </div>
                    </div>
                    <div class="status-card">
                        <div class="status-icon">🏆</div>
                        <div class="status-info">
                            <div class="status-number" id="total-rewards">0</div>
                            <div class="status-label">Kazanılan Rozet</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Hybrid Storage Status -->
            <div class="admin-section">
                <h3>🔄 Hibrit Storage Durumu</h3>
                <div class="storage-status">
                    <div class="storage-item">
                        <div class="storage-icon">💾</div>
                        <div class="storage-info">
                            <div class="storage-title">Local Storage</div>
                            <div class="storage-desc">Çevrimdışı veri depolama</div>
                            <div class="storage-status-indicator local-storage">Aktif</div>
                        </div>
                    </div>
                    <div class="storage-item">
                        <div class="storage-icon">☁️</div>
                        <div class="storage-info">
                            <div class="storage-title">Backend Storage</div>
                            <div class="storage-desc">Çevrimiçi senkronizasyon</div>
                            <div class="storage-status-indicator" id="backend-storage-status">Test Edilmedi</div>
                        </div>
                    </div>
                    <div class="storage-item">
                        <div class="storage-icon">🔄</div>
                        <div class="storage-info">
                            <div class="storage-title">Sync Queue</div>
                            <div class="storage-desc">Bekleyen senkronizasyon</div>
                            <div class="storage-status-indicator" id="sync-queue-status">0 öğe</div>
                        </div>
                    </div>
                </div>
                <div class="storage-actions">
                    <button onclick="forceSyncAll()" class="btn-secondary">
                        <span>🔄</span>
                        Tümünü Senkronize Et
                    </button>
                    <button onclick="clearSyncQueue()" class="btn-secondary">
                        <span>🗑️</span>
                        Sync Kuyruğunu Temizle
                    </button>
                </div>
            </div>

            <!-- Backend Configuration -->
            <div class="admin-section">
                <h3>🌐 Backend Yapılandırması</h3>
                <div class="config-form">
                    <div class="form-group">
                        <label for="admin-backend-url">Backend URL</label>
                        <input type="url" id="admin-backend-url" placeholder="https://your-backend.onrender.com/api">
                        <small>Backend API'niz için tam URL'yi girin</small>
                    </div>
                    <div class="form-group">
                        <label>Bağlantı Durumu</label>
                        <div class="connection-status">
                            <span id="admin-connection-status" class="status-offline">Test Edilmedi</span>
                            <button onclick="testAdminConnection()" class="btn-secondary">Bağlantıyı Test Et</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Debug Settings -->
            <div class="admin-section">
                <h3>🐛 Debug Ayarları</h3>
                <div class="debug-settings">
                    <div class="setting-item">
                        <label class="switch">
                            <input type="checkbox" id="admin-debug-mode">
                            <span class="slider"></span>
                        </label>
                        <div class="setting-info">
                            <div class="setting-title">Debug Modu</div>
                            <div class="setting-desc">Giriş ekranını atla, test verileri oluştur</div>
                        </div>
                    </div>
                    <div class="setting-item">
                        <label class="switch">
                            <input type="checkbox" id="admin-console-logs">
                            <span class="slider"></span>
                        </label>
                        <div class="setting-info">
                            <div class="setting-title">Console Logları</div>
                            <div class="setting-desc">Detaylı sistem loglarını etkinleştir</div>
                        </div>
                    </div>
                    <div class="setting-item">
                        <label class="switch">
                            <input type="checkbox" id="admin-analytics">
                            <span class="slider"></span>
                        </label>
                        <div class="setting-info">
                            <div class="setting-title">Analytics</div>
                            <div class="setting-desc">Kullanım istatistiklerini topla</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Data Management -->
            <div class="admin-section">
                <h3>💾 Veri Yönetimi</h3>
                <div class="data-actions">
                    <button onclick="exportAllData()" class="btn-secondary">
                        <span>📤</span>
                        Tüm Verileri Dışa Aktar
                    </button>
                    <button onclick="importData()" class="btn-secondary">
                        <span>📥</span>
                        Veri İçe Aktar
                    </button>
                    <button onclick="clearAllData()" class="btn-danger">
                        <span>🗑️</span>
                        Tüm Verileri Temizle
                    </button>
                </div>
            </div>

            <!-- System Logs -->
            <div class="admin-section">
                <h3>📋 Sistem Logları</h3>
                <div class="logs-container">
                    <div class="logs-header">
                        <span>Son Aktiviteler</span>
                        <button onclick="clearLogs()" class="btn-small">Temizle</button>
                    </div>
                    <div id="admin-logs" class="logs-content">
                        <div class="log-entry">
                            <span class="log-time">2024-01-15 14:30:22</span>
                            <span class="log-level info">INFO</span>
                            <span class="log-message">Admin paneli açıldı</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="admin-section">
                <h3>⚡ Hızlı İşlemler</h3>
                <div class="quick-actions">
                    <button onclick="generateTestData()" class="action-btn">
                        <span>🧪</span>
                        <div>
                            <div class="action-title">Test Verisi Oluştur</div>
                            <div class="action-desc">Örnek veli ve çocuk verileri ekle</div>
                        </div>
                    </button>
                    <button onclick="resetAllStreaks()" class="action-btn">
                        <span>🔄</span>
                        <div>
                            <div class="action-title">Serileri Sıfırla</div>
                            <div class="action-desc">Tüm çocukların serilerini sıfırla</div>
                        </div>
                    </button>
                    <button onclick="recalculateRewards()" class="action-btn">
                        <span>🏆</span>
                        <div>
                            <div class="action-title">Rozetleri Yeniden Hesapla</div>
                            <div class="action-desc">Tüm rozetleri kontrol et ve güncelle</div>
                        </div>
                    </button>
                </div>
            </div>

            <!-- Save Button -->
            <div class="admin-actions">
                <button onclick="saveAdminSettings()" class="btn-primary btn-large">
                    💾 Ayarları Kaydet
                </button>
            </div>
        </div>
    </div>

    <!-- Dashboard Screen -->
    <div id="dashboard-screen" class="screen">
        <div class="header">
            <div class="header-left">
                <h1>Merhaba, <span id="parent-name-display"></span>!</h1>
                <div class="sync-status">
                    <span id="sync-indicator" class="sync-offline">Çevrimdışı</span>
                </div>
            </div>
            <button class="profile-btn" onclick="showScreen('profile-screen')">👤</button>
        </div>

        <div class="children-section">
            <div class="section-header">
                <h2>Çocuklar</h2>
                <button class="btn-secondary" onclick="showAddChildForm()">+ Çocuk Ekle</button>
            </div>
            <div id="children-list" class="children-grid"></div>
        </div>

        <!-- Add Child Form -->
        <div id="add-child-form" class="modal" style="display: none;">
            <div class="modal-content">
                <h3>Yeni Çocuk Ekle</h3>
                <form id="child-form">
                    <div class="form-group">
                        <label for="child-name">Çocuk Adı</label>
                        <input type="text" id="child-name" required>
                    </div>
                    <div class="form-group">
                        <label for="child-age">Yaş</label>
                        <input type="number" id="child-age" min="0" max="18" required>
                    </div>
                    <div class="form-group">
                        <label>Avatar Seç</label>
                        <div class="avatar-grid" id="avatar-selection"></div>
                    </div>
                    <div class="form-actions">
                        <button type="button" onclick="hideAddChildForm()">İptal</button>
                        <button type="submit" class="btn-primary">Kaydet</button>
                    </div>
                </form>
            </div>
        </div>

        <div class="bottom-nav">
            <button class="nav-btn active" onclick="showScreen('dashboard-screen')">
                <span>🏠</span>
                <span>Ana Sayfa</span>
            </button>
            <button class="nav-btn" onclick="showScreen('timer-screen')">
                <span>⏰</span>
                <span>Timer</span>
            </button>
            <button class="nav-btn" onclick="showScreen('stats-screen')">
                <span>📊</span>
                <span>İstatistik</span>
            </button>
            <button class="nav-btn" onclick="showScreen('profile-screen')">
                <span>👤</span>
                <span>Profil</span>
            </button>
        </div>
    </div>

    <!-- Child Detail Screen -->
    <div id="child-detail-screen" class="screen">
        <div class="header">
            <button class="back-btn" onclick="showScreen('dashboard-screen')">←</button>
            <h1 id="child-detail-name"></h1>
            <button class="edit-btn" onclick="editChild()">✏️</button>
        </div>

        <div class="child-profile">
            <div class="child-avatar-large" id="child-detail-avatar"></div>
            <div class="child-info">
                <h2 id="child-detail-name-display"></h2>
                <p id="child-detail-age"></p>
                <div class="streak-info">
                    <div class="streak-item">
                        <span class="streak-number" id="current-streak">0</span>
                        <span class="streak-label">Güncel Seri</span>
                    </div>
                    <div class="streak-item">
                        <span class="streak-number" id="longest-streak">0</span>
                        <span class="streak-label">En Uzun Seri</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="quick-actions">
            <button class="action-btn morning" onclick="startTimer('morning')">
                <span>🌅</span>
                <span>Sabah Fırçalama</span>
            </button>
            <button class="action-btn evening" onclick="startTimer('evening')">
                <span>🌙</span>
                <span>Akşam Fırçalama</span>
            </button>
        </div>

        <div class="rewards-section">
            <h3>Rozetler</h3>
            <div id="child-rewards" class="rewards-grid"></div>
        </div>

        <div class="recent-activity">
            <h3>Son Aktiviteler</h3>
            <div id="recent-brushing" class="activity-list"></div>
        </div>
    </div>

    <!-- Timer Screen -->
    <div id="timer-screen" class="screen">
        <div class="header">
            <button class="back-btn" onclick="showScreen('dashboard-screen')">←</button>
            <h1>Diş Fırçalama</h1>
            <div class="session-type" id="session-type-display">Sabah</div>
        </div>

        <div class="timer-container">
            <div class="timer-circle" id="timer-circle">
                <div class="timer-display">
                    <span id="timer-minutes">02</span>
                    <span class="timer-colon">:</span>
                    <span id="timer-seconds">00</span>
                </div>
                <div class="timer-progress" id="timer-progress"></div>
            </div>
            
            <div class="timer-controls">
                <button id="timer-btn" class="btn-primary" onclick="toggleTimer()">Başla</button>
            </div>

            <div class="brushing-tips" id="brushing-tips">
                <h3>Fırçalama İpucu</h3>
                <p id="current-tip">Dişlerini nazikçe dairesel hareketlerle fırçala!</p>
            </div>

            <div class="timer-effects" id="timer-effects"></div>
        </div>
    </div>

    <!-- Stats Screen -->
    <div id="stats-screen" class="screen">
        <div class="header">
            <h1>İstatistikler</h1>
            <div class="stats-filter">
                <select id="stats-child-filter">
                    <option value="all">Tüm Çocuklar</option>
                </select>
            </div>
        </div>

        <div class="stats-overview">
            <div class="stat-card">
                <div class="stat-number" id="total-brushings">0</div>
                <div class="stat-label">Toplam Fırçalama</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="avg-duration">0</div>
                <div class="stat-label">Ortalama Süre</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="best-streak">0</div>
                <div class="stat-label">En İyi Seri</div>
            </div>
        </div>

        <div class="stats-charts">
            <div class="chart-section">
                <h3>Haftalık Aktivite</h3>
                <div id="weekly-chart" class="chart"></div>
            </div>
            <div class="chart-section">
                <h3>Günlük Dağılım</h3>
                <div id="daily-distribution" class="chart"></div>
            </div>
        </div>

        <div class="bottom-nav">
            <button class="nav-btn" onclick="showScreen('dashboard-screen')">
                <span>🏠</span>
                <span>Ana Sayfa</span>
            </button>
            <button class="nav-btn" onclick="showScreen('timer-screen')">
                <span>⏰</span>
                <span>Timer</span>
            </button>
            <button class="nav-btn active" onclick="showScreen('stats-screen')">
                <span>📊</span>
                <span>İstatistik</span>
            </button>
            <button class="nav-btn" onclick="showScreen('profile-screen')">
                <span>👤</span>
                <span>Profil</span>
            </button>
        </div>
    </div>

    <!-- Profile Screen -->
    <div id="profile-screen" class="screen">
        <div class="header">
            <h1>Profil</h1>
        </div>

        <div class="profile-section">
            <h3>Veli Bilgileri</h3>
            <div class="profile-info">
                <div class="info-item">
                    <label>Ad Soyad:</label>
                    <span id="profile-parent-name"></span>
                </div>
                <div class="info-item">
                    <label>Telefon:</label>
                    <span id="profile-parent-phone"></span>
                </div>
                <div class="info-item">
                    <label>E-posta:</label>
                    <span id="profile-parent-email"></span>
                </div>
            </div>
        </div>

        <div class="profile-section">
            <h3>Uygulama Ayarları</h3>
            <div class="settings-list">
                <div class="setting-item">
                    <label>Bildirimler</label>
                    <input type="checkbox" id="notifications-enabled" checked>
                </div>
                <div class="setting-item">
                    <label>Sabah Hatırlatma</label>
                    <input type="time" id="morning-reminder" value="08:00">
                </div>
                <div class="setting-item">
                    <label>Akşam Hatırlatma</label>
                    <input type="time" id="evening-reminder" value="20:00">
                </div>
            </div>
        </div>

        <div class="profile-actions">
            <button class="btn-secondary" onclick="exportData()">Verileri Dışa Aktar</button>
            <button class="btn-danger" onclick="logout()">Çıkış Yap</button>
        </div>

        <div class="bottom-nav">
            <button class="nav-btn" onclick="showScreen('dashboard-screen')">
                <span>🏠</span>
                <span>Ana Sayfa</span>
            </button>
            <button class="nav-btn" onclick="showScreen('timer-screen')">
                <span>⏰</span>
                <span>Timer</span>
            </button>
            <button class="nav-btn" onclick="showScreen('stats-screen')">
                <span>📊</span>
                <span>İstatistik</span>
            </button>
            <button class="nav-btn active" onclick="showScreen('profile-screen')">
                <span>👤</span>
                <span>Profil</span>
            </button>
        </div>
    </div>

    <script src="data.js"></script>
    <script src="api.js"></script>
    <script src="timer.js"></script>
    <script src="sync.js"></script>
    <script src="app.js"></script>
    
    <script>
        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => console.log('SW registered'))
                    .catch(error => console.log('SW registration failed'));
            });
        }
    </script>
</body>
</html>
